## Last changed: 2025-02-21 10:35:36 PST
version 23.4R2-S4.4;
system {
    host-name dc3-rack-001-leaf2;
    services {
        netconf {
            ssh;
        }
        ssh {
            root-login allow;
        }
        extension-service {
            request-response {
                grpc {
                    ssl {
                        port 32767;
                        local-certificate aos_grpc;
                    }
                    routing-instance mgmt_junos;
                }
            }
        }
    }
    management-instance;
    ports {
        console log-out-on-disconnect;
    }
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 1;
        }
    }
}
security {
    certificates {
        local {
            aos_grpc {
                 ## SECRET-DATA
            }
        }
    }
    macsec {
        connectivity-association dc1-dc3-dci {
            cipher-suite gcm-aes-xpn-128;
            security-mode static-cak;
            pre-shared-key {
                ckn 1234abcd1234abcd1234abcd1234abcd1234abcd1234abcd1234abcd1234abcd;
                cak "secret"; ## SECRET-DATA
            }
        }
        interfaces {
            xe-0/0/12 {
                connectivity-association dc1-dc3-dci;
            }
        }
    }
}
interfaces {
    xe-0/0/0 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/1 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/2 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/3 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/4 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/5 {
        description to.dc3-rack-001-sys003;
        mtu 9216;
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members [ vn400 vn401 vn402 vn403 vn404 vn405 vn406 vn407 vn408 vn409 vn1400 vn1401 vn1402 vn1403 vn1404 vn1405 vn1406 vn1407 vn1408 vn1409 ];
                }
            }
        }
    }
    xe-0/0/6 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/7 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/8 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/9 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/10 {
        description to.dc3-rack-001-sys004;
        flexible-vlan-tagging;
        native-vlan-id 1;
        unit 199 {
            description "VRF red to dc3_rack_001_sys004";
            vlan-id 199;
            family inet {
                address 10.200.2.2/31;
            }
        }
        unit 299 {
            description "VRF blue to dc3_rack_001_sys004";
            vlan-id 299;
            family inet {
                address 10.200.2.6/31;
            }
        }
    }
    xe-0/0/11 {
        description to.dc3-rack-001-sys001;
        hold-time up 100000 down 0;
        ether-options {
            802.3ad ae1;
        }
    }
    xe-0/0/12 {
        description to.dc3-dc1-link2;
        flexible-vlan-tagging;
        native-vlan-id 1;
        mtu 9216;
        unit 3101 {
            description "VRF default to DC3-DC1-link2";
            vlan-id 3101;
            family inet {
                mtu 9100;
                address 172.28.0.2/24;
            }
        }
    }
    xe-0/0/13 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/14 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/15 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/16 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/17 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/18 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/19 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/20 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/21 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/22 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/23 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/24 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/25 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/26 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/27 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/28 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/29 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/30 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/31 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/32 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/33 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/34 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/35 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/36 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/37 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/38 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/39 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/40 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/41 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/42 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/43 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/44 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/45 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/46 {
        unit 0 {
            family inet;
        }
    }
    xe-0/0/47 {
        unit 0 {
            family inet;
        }
    }
    et-0/0/48 {
        description facing_dc3-rack-001-leaf1:et-0/0/48;
        mtu 9216;
        unit 0 {
            family inet {
                mtu 9170;
                address 10.0.3.0/31;
            }
        }
    }
    et-0/0/49 {
        description facing_dc3-rack-001-leaf1:et-0/0/49;
        mtu 9216;
        unit 0 {
            family inet {
                mtu 9170;
                address 10.0.3.2/31;
            }
        }
    }
    et-0/0/50 {
        unit 0 {
            family inet;
        }
    }
    et-0/0/51 {
        unit 0 {
            family inet;
        }
    }
    et-0/0/52 {
        unit 0 {
            family inet;
        }
    }
    et-0/0/53 {
        unit 0 {
            family inet;
        }
    }
    et-0/0/54 {
        unit 0 {
            family inet;
        }
    }
    et-0/0/55 {
        unit 0 {
            family inet;
        }
    }
    ae1 {
        description to.dc3-rack-001-sys001;
        mtu 9216;
        esi {
            00:06:00:00:00:00:01:00:00:01;
            all-active;
        }
        aggregated-ether-options {
            lacp {
                active;
                system-id 06:00:00:00:00:01;
            }
        }
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members [ vn400 vn401 vn402 vn403 vn404 vn405 vn406 vn407 vn408 vn409 vn1400 vn1401 vn1402 vn1403 vn1404 vn1405 vn1406 vn1407 vn1408 vn1409 ];
                }
            }
        }
    }
    irb {
        unit 400 {
            family inet {
                mtu 9000;
                address 10.0.0.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:00::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 401 {
            family inet {
                mtu 9000;
                address 10.0.1.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:01::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 402 {
            family inet {
                mtu 9000;
                address 10.0.2.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:02::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 403 {
            family inet {
                mtu 9000;
                address 10.0.3.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:03::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 404 {
            family inet {
                mtu 9000;
                address 10.0.4.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:04::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 405 {
            family inet {
                mtu 9000;
                address 10.0.5.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:05::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 406 {
            family inet {
                mtu 9000;
                address 10.0.6.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:06::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 407 {
            family inet {
                mtu 9000;
                address 10.0.7.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:07::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 408 {
            family inet {
                mtu 9000;
                address 10.0.8.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:08::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 409 {
            family inet {
                mtu 9000;
                address 10.0.9.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:00:09::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1400 {
            family inet {
                mtu 9000;
                address 10.10.0.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:00::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1401 {
            family inet {
                mtu 9000;
                address 10.10.1.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:01::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1402 {
            family inet {
                mtu 9000;
                address 10.10.2.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:02::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1403 {
            family inet {
                mtu 9000;
                address 10.10.3.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:03::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1404 {
            family inet {
                mtu 9000;
                address 10.10.4.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:04::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1405 {
            family inet {
                mtu 9000;
                address 10.10.5.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:05::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1406 {
            family inet {
                mtu 9000;
                address 10.10.6.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:06::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1407 {
            family inet {
                mtu 9000;
                address 10.10.7.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:07::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1408 {
            family inet {
                mtu 9000;
                address 10.10.8.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:08::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
        unit 1409 {
            family inet {
                mtu 9000;
                address 10.10.9.1/24;
            }
            family inet6 {
                mtu 9000;
                address 2001:db8:dc3:10:0a:09::1/96;
            }
            mac 00:1c:73:00:00:01;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 192.168.253.1/32;
            }
            family inet6 {
                address fdf6:ed70:1fac:f2d3::1001/128;
            }
        }
        unit 2 {
            family inet {
                address 192.168.13.3/32;
            }
            family inet6 {
                address fdf6:ed70:1fac:f2d3::2001/128;
            }
        }
        unit 3 {
            family inet {
                address 192.168.13.2/32;
            }
            family inet6 {
                address fdf6:ed70:1fac:f2d3::2003/128;
            }
        }
    }
}
forwarding-options {
    evpn-vxlan {
        shared-tunnels;
        vxlan-trans-vni-enable;
    }
    vxlan-routing {
        next-hop 45056;
        interface-num 8192;
        overlay-ecmp;
    }
}
policy-options {
    route-filter-list RoutesFromExt-blue-external_router {
        0.0.0.0/0 exact;
    }
    route-filter-list RoutesFromExt-default-DC3-DCI_2 {
        192.168.255.3/32 exact;
        192.168.255.2/32 exact;
    }
    route-filter-list RoutesFromExt-red-external_router {
        0.0.0.0/0 exact;
    }
    route-filter-list RoutesToExt-blue-external_router {
        0.0.0.0/0 prefix-length-range /1-/32;
        10.10.0.0/21 upto /32;
        10.10.8.0/23 upto /32;
        192.168.13.0/32 exact;
        192.168.13.2/32 exact;
    }
    route-filter-list RoutesToExt-default-DC3-DCI_2 {
        192.168.253.1/32 exact;
        192.168.253.0/31 upto /32;
    }
    route-filter-list RoutesToExt-red-external_router {
        0.0.0.0/0 prefix-length-range /1-/32;
        10.0.0.0/21 upto /32;
        10.0.8.0/23 upto /32;
        192.168.13.1/32 exact;
        192.168.13.3/32 exact;
    }
    policy-statement AllPodNetworks {
        term AllPodNetworks-10 {
            from {
                family inet;
                protocol direct;
            }
            then {
                community add DEFAULT_DIRECT_V4;
                accept;
            }
        }
        term AllPodNetworks-20 {
            from {
                family inet6;
                protocol direct;
            }
            then {
                community add DEFAULT_DIRECT_V6;
                accept;
            }
        }
        term AllPodNetworks-100 {
            then reject;
        }
    }
    policy-statement AllPodNetworks-blue {
        term AllPodNetworks-blue-10 {
            from {
                family inet;
                protocol direct;
            }
            then {
                community add BLUE_COMMUNITY_V4;
                accept;
            }
        }
        term AllPodNetworks-blue-20 {
            from {
                family inet6;
                protocol direct;
            }
            then {
                community add BLUE_COMMUNITY_V6;
                accept;
            }
        }
        term AllPodNetworks-blue-100 {
            then reject;
        }
    }
    policy-statement AllPodNetworks-red {
        term AllPodNetworks-red-10 {
            from {
                family inet;
                protocol direct;
            }
            then {
                community add RED_COMMUNITY_V4;
                accept;
            }
        }
        term AllPodNetworks-red-20 {
            from {
                family inet6;
                protocol direct;
            }
            then {
                community add RED_COMMUNITY_V6;
                accept;
            }
        }
        term AllPodNetworks-red-100 {
            then reject;
        }
    }
    policy-statement BGP-AOS-Policy {
        term BGP-AOS-Policy-10 {
            from policy AllPodNetworks;
            then accept;
        }
        term BGP-AOS-Policy-20 {
            from protocol bgp;
            then accept;
        }
        term BGP-AOS-Policy-100 {
            then reject;
        }
    }
    policy-statement BGP-AOS-Policy-blue {
        term BGP-AOS-Policy-blue-10 {
            from policy AllPodNetworks-blue;
            then accept;
        }
        term BGP-AOS-Policy-blue-20 {
            from protocol bgp;
            then accept;
        }
        term BGP-AOS-Policy-blue-100 {
            then reject;
        }
    }
    policy-statement BGP-AOS-Policy-red {
        term BGP-AOS-Policy-red-10 {
            from policy AllPodNetworks-red;
            then accept;
        }
        term BGP-AOS-Policy-red-20 {
            from protocol bgp;
            then accept;
        }
        term BGP-AOS-Policy-red-100 {
            then reject;
        }
    }
    policy-statement EVPN_EXPORT {
        term EVPN_EXPORT-4095 {
            then accept;
        }
    }
    policy-statement EVPN_GW_IN {
        term EVPN_GW_IN-10 {
            from {
                family evpn;
                community EVPN_DCI_L2_TARGET;
            }
            then {
                community add EVPN_GW_IN;
                community add NO_ADVERTISE;
                accept;
            }
        }
        term EVPN_GW_IN-20 {
            from family evpn;
            then reject;
        }
    }
    policy-statement EVPN_GW_OUT {
        term EVPN_GW_OUT-10 {
            from {
                family evpn;
                community EVPN_GW_OUT;
            }
            then reject;
        }
        term EVPN_GW_OUT-20 {
            from {
                family evpn;
                community EVPN_DCI_L2_TARGET;
            }
            then {
                community delete FABRIC_COMMUNITIES;
                accept;
            }
        }
        term EVPN_GW_OUT-30 {
            from family evpn;
            then reject;
        }
    }
    policy-statement LEAF_TO_LEAF_EVPN_OUT {
        term LEAF_TO_LEAF_EVPN_OUT-10 {
            from {
                protocol [ bgp evpn ];
                community FABRIC_EVI_TARGET;
            }
            then accept;
        }
        term LEAF_TO_LEAF_EVPN_OUT-20 {
            from {
                protocol [ bgp evpn ];
                community EVPN_DCI_L2_TARGET;
            }
            then reject;
        }
        term LEAF_TO_LEAF_EVPN_OUT-30 {
            then accept;
        }
    }
    policy-statement PFE-LB {
        then {
            load-balance per-packet;
        }
    }
    policy-statement RoutesFromExt-blue-external_router {
        term RoutesFromExt-blue-external_router-10 {
            from {
                family inet;
                route-filter-list RoutesFromExt-blue-external_router;
            }
            then {
                community add RoutesFromExt-blue-external_router;
                accept;
            }
        }
        term RoutesFromExt-blue-external_router-30 {
            from family inet;
            then reject;
        }
    }
    policy-statement RoutesFromExt-default-DC3-DCI_2 {
        term RoutesFromExt-default-DC3-DCI_2-10 {
            from {
                family inet;
                route-filter-list RoutesFromExt-default-DC3-DCI_2;
            }
            then {
                community add RoutesFromExt-default-DC3-DCI_2;
                accept;
            }
        }
        term RoutesFromExt-default-DC3-DCI_2-30 {
            from family inet;
            then reject;
        }
    }
    policy-statement RoutesFromExt-red-external_router {
        term RoutesFromExt-red-external_router-10 {
            from {
                family inet;
                route-filter-list RoutesFromExt-red-external_router;
            }
            then {
                community add RoutesFromExt-red-external_router;
                accept;
            }
        }
        term RoutesFromExt-red-external_router-30 {
            from family inet;
            then reject;
        }
    }
    policy-statement RoutesToExt-blue-external_router {
        term RoutesToExt-blue-external_router-10 {
            from {
                family inet;
                route-filter-list RoutesToExt-blue-external_router;
            }
            then {
                community delete FABRIC_COMMUNITIES;
                accept;
            }
        }
        term RoutesToExt-blue-external_router-30 {
            from family inet;
            then reject;
        }
    }
    policy-statement RoutesToExt-default-DC3-DCI_2 {
        term RoutesToExt-default-DC3-DCI_2-10 {
            from {
                family inet;
                route-filter-list RoutesToExt-default-DC3-DCI_2;
            }
            then {
                community delete FABRIC_COMMUNITIES;
                next-hop self;
                accept;
            }
        }
        term RoutesToExt-default-DC3-DCI_2-30 {
            from family inet;
            then reject;
        }
    }
    policy-statement RoutesToExt-red-external_router {
        term RoutesToExt-red-external_router-10 {
            from {
                family inet;
                route-filter-list RoutesToExt-red-external_router;
            }
            then {
                community delete FABRIC_COMMUNITIES;
                accept;
            }
        }
        term RoutesToExt-red-external_router-30 {
            from family inet;
            then reject;
        }
    }
    community BLUE_COMMUNITY_V4 members [ 2:20007 21003:26000 ];
    community BLUE_COMMUNITY_V6 members [ 2:20008 21003:26000 ];
    community DEFAULT_DIRECT_V4 members [ 2:20007 21001:26000 ];
    community DEFAULT_DIRECT_V6 members [ 2:20008 21001:26000 ];
    community EVPN_DCI_L2_TARGET members target:65655L:1;
    community EVPN_GW_IN members [ 2:20001 21000:26000 ];
    community EVPN_GW_OUT members .+:20001;
    community FABRIC_COMMUNITIES members [ 0:12 0:13 0:14 0:15 .+:200.. 2....:260.. ];
    community FABRIC_EVI_TARGET members target:100:100;
    community NO_ADVERTISE members no-advertise;
    community RED_COMMUNITY_V4 members [ 2:20007 21002:26000 ];
    community RED_COMMUNITY_V6 members [ 2:20008 21002:26000 ];
    community RoutesFromExt-blue-external_router members [ 2:20009 21003:26000 ];
    community RoutesFromExt-default-DC3-DCI_2 members [ 2:20009 21001:26000 ];
    community RoutesFromExt-red-external_router members [ 2:20009 21002:26000 ];
    community RoutesFromExtV6-blue-external_router members [ 2:20010 21003:26000 ];
    community RoutesFromExtV6-default-DC3-DCI_2 members [ 2:20010 21001:26000 ];
    community RoutesFromExtV6-red-external_router members [ 2:20010 21002:26000 ];
}
routing-instances {
    blue {
        instance-type vrf;
        routing-options {
            rib blue.inet6.0 {
                multipath;
            }
            graceful-restart;
            multipath;
            auto-export;
        }
        protocols {
            bgp {
                group l3rtr {
                    type external;
                    multihop {
                        ttl 1;
                    }
                    family inet {
                        unicast {
                            loops 2;
                        }
                    }
                    family inet6 {
                        unicast {
                            loops 2;
                        }
                    }
                    multipath {
                        multiple-as;
                    }
                    neighbor 10.200.2.7 {
                        description facing_dc3-rack-001-sys004;
                        multihop {
                            ttl 2;
                        }
                        local-address 10.200.2.6;
                        import ( RoutesFromExt-blue-external_router );
                        family inet {
                            unicast;
                        }
                        export ( RoutesToExt-blue-external_router );
                        peer-as 65000;
                    }
                }
                graceful-restart {
                    dont-help-shared-fate-bfd-down;
                }
            }
            evpn {
                ip-prefix-routes {
                    advertise direct-nexthop;
                    encapsulation vxlan;
                    vni 13200;
                    export BGP-AOS-Policy-blue;
                }
            }
        }
        interface xe-0/0/10.299;
        interface irb.1400;
        interface irb.1401;
        interface irb.1402;
        interface irb.1403;
        interface irb.1404;
        interface irb.1405;
        interface irb.1406;
        interface irb.1407;
        interface irb.1408;
        interface irb.1409;
        interface lo0.3;
        route-distinguisher 192.168.253.1:3200;
        vrf-target target:13200:1;
    }
    evpn-1 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation vxlan;
                default-gateway do-not-advertise;
                duplicate-mac-detection {
                    auto-recovery-time 9;
                }
                extended-vni-list all;
                interconnect {
                    vrf-target target:65655L:1;
                    route-distinguisher 192.168.253.1:65533;
                    esi {
                        00:06:ff:00:00:00:01:00:00:01;
                        all-active;
                    }
                    interconnected-vni-list [ 10400 10401 10402 10403 10404 10405 10406 10407 10408 10409 41400 41401 41402 41403 41404 41405 41406 41407 41408 41409 ];
                }
                vni-options {
                    vni 10400 {
                        vrf-target target:10400:1;
                    }
                    vni 10401 {
                        vrf-target target:10401:1;
                    }
                    vni 10402 {
                        vrf-target target:10402:1;
                    }
                    vni 10403 {
                        vrf-target target:10403:1;
                    }
                    vni 10404 {
                        vrf-target target:10404:1;
                    }
                    vni 10405 {
                        vrf-target target:10405:1;
                    }
                    vni 10406 {
                        vrf-target target:10406:1;
                    }
                    vni 10407 {
                        vrf-target target:10407:1;
                    }
                    vni 10408 {
                        vrf-target target:10408:1;
                    }
                    vni 10409 {
                        vrf-target target:10409:1;
                    }
                    vni 31400 {
                        vrf-target target:31400:1;
                    }
                    vni 31401 {
                        vrf-target target:31401:1;
                    }
                    vni 31402 {
                        vrf-target target:31402:1;
                    }
                    vni 31403 {
                        vrf-target target:31403:1;
                    }
                    vni 31404 {
                        vrf-target target:31404:1;
                    }
                    vni 31405 {
                        vrf-target target:31405:1;
                    }
                    vni 31406 {
                        vrf-target target:31406:1;
                    }
                    vni 31407 {
                        vrf-target target:31407:1;
                    }
                    vni 31408 {
                        vrf-target target:31408:1;
                    }
                    vni 31409 {
                        vrf-target target:31409:1;
                    }
                }
            }
        }
        vtep-source-interface lo0.0;
        service-type vlan-aware;
        interface xe-0/0/5.0;
        interface ae1.0;
        route-distinguisher 192.168.253.1:65534;
        vrf-target target:100:100;
        vlans {
            vn1400 {
                description blue_all_1400;
                vlan-id 1400;
                l3-interface irb.1400;
                vxlan {
                    vni 31400;
                    translation-vni 41400;
                }
            }
            vn1401 {
                description blue_all_1401;
                vlan-id 1401;
                l3-interface irb.1401;
                vxlan {
                    vni 31401;
                    translation-vni 41401;
                }
            }
            vn1402 {
                description blue_all_1402;
                vlan-id 1402;
                l3-interface irb.1402;
                vxlan {
                    vni 31402;
                    translation-vni 41402;
                }
            }
            vn1403 {
                description blue_all_1403;
                vlan-id 1403;
                l3-interface irb.1403;
                vxlan {
                    vni 31403;
                    translation-vni 41403;
                }
            }
            vn1404 {
                description blue_all_1404;
                vlan-id 1404;
                l3-interface irb.1404;
                vxlan {
                    vni 31404;
                    translation-vni 41404;
                }
            }
            vn1405 {
                description blue_all_1405;
                vlan-id 1405;
                l3-interface irb.1405;
                vxlan {
                    vni 31405;
                    translation-vni 41405;
                }
            }
            vn1406 {
                description blue_all_1406;
                vlan-id 1406;
                l3-interface irb.1406;
                vxlan {
                    vni 31406;
                    translation-vni 41406;
                }
            }
            vn1407 {
                description blue_all_1407;
                vlan-id 1407;
                l3-interface irb.1407;
                vxlan {
                    vni 31407;
                    translation-vni 41407;
                }
            }
            vn1408 {
                description blue_all_1408;
                vlan-id 1408;
                l3-interface irb.1408;
                vxlan {
                    vni 31408;
                    translation-vni 41408;
                }
            }
            vn1409 {
                description blue_all_1409;
                vlan-id 1409;
                l3-interface irb.1409;
                vxlan {
                    vni 31409;
                    translation-vni 41409;
                }
            }
            vn400 {
                description red_all_400;
                vlan-id 400;
                l3-interface irb.400;
                vxlan {
                    vni 10400;
                }
            }
            vn401 {
                description red_all_401;
                vlan-id 401;
                l3-interface irb.401;
                vxlan {
                    vni 10401;
                }
            }
            vn402 {
                description red_all_402;
                vlan-id 402;
                l3-interface irb.402;
                vxlan {
                    vni 10402;
                }
            }
            vn403 {
                description red_all_403;
                vlan-id 403;
                l3-interface irb.403;
                vxlan {
                    vni 10403;
                }
            }
            vn404 {
                description red_all_404;
                vlan-id 404;
                l3-interface irb.404;
                vxlan {
                    vni 10404;
                }
            }
            vn405 {
                description red_all_405;
                vlan-id 405;
                l3-interface irb.405;
                vxlan {
                    vni 10405;
                }
            }
            vn406 {
                description red_all_406;
                vlan-id 406;
                l3-interface irb.406;
                vxlan {
                    vni 10406;
                }
            }
            vn407 {
                description red_all_407;
                vlan-id 407;
                l3-interface irb.407;
                vxlan {
                    vni 10407;
                }
            }
            vn408 {
                description red_all_408;
                vlan-id 408;
                l3-interface irb.408;
                vxlan {
                    vni 10408;
                }
            }
            vn409 {
                description red_all_409;
                vlan-id 409;
                l3-interface irb.409;
                vxlan {
                    vni 10409;
                }
            }
        }
    }
    red {
        instance-type vrf;
        routing-options {
            rib red.inet6.0 {
                multipath;
            }
            graceful-restart;
            multipath;
            auto-export;
        }
        protocols {
            bgp {
                group l3rtr {
                    type external;
                    multihop {
                        ttl 1;
                    }
                    family inet {
                        unicast {
                            loops 2;
                        }
                    }
                    family inet6 {
                        unicast {
                            loops 2;
                        }
                    }
                    multipath {
                        multiple-as;
                    }
                    neighbor 10.200.2.3 {
                        description facing_dc3-rack-001-sys004;
                        multihop {
                            ttl 2;
                        }
                        local-address 10.200.2.2;
                        import ( RoutesFromExt-red-external_router );
                        family inet {
                            unicast;
                        }
                        export ( RoutesToExt-red-external_router );
                        peer-as 65000;
                    }
                }
                graceful-restart {
                    dont-help-shared-fate-bfd-down;
                }
            }
            evpn {
                ip-prefix-routes {
                    advertise direct-nexthop;
                    encapsulation vxlan;
                    vni 13100;
                    export BGP-AOS-Policy-red;
                }
            }
        }
        interface xe-0/0/10.199;
        interface irb.400;
        interface irb.401;
        interface irb.402;
        interface irb.403;
        interface irb.404;
        interface irb.405;
        interface irb.406;
        interface irb.407;
        interface irb.408;
        interface irb.409;
        interface lo0.2;
        route-distinguisher 192.168.253.1:3100;
        vrf-target target:13100:1;
    }
}
routing-options {
    router-id 192.168.253.1;
    autonomous-system 64801;
    graceful-restart;
    forwarding-table {
        export PFE-LB;
        ecmp-fast-reroute;
        chained-composite-next-hop {
            ingress {
                evpn;
            }
        }
    }
}
protocols {
    router-advertisement {
        interface irb.1400 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1401 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1402 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1403 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1404 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1405 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1406 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1407 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1408 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.1409 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.400 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.401 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.402 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.403 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.404 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.405 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.406 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.407 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.408 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
        interface irb.409 {
            max-advertisement-interval 30;
            min-advertisement-interval 10;
        }
    }
    bgp {
        group l3clos-l {
            type external;
            multipath {
                multiple-as;
            }
            bfd-liveness-detection {
                minimum-interval 1000;
                multiplier 3;
            }
            neighbor 10.0.3.1 {
                description facing_dc3-rack-001-leaf1;
                local-address 10.0.3.0;
                family inet {
                    unicast;
                }
                export ( BGP-AOS-Policy );
                peer-as 64800;
            }
            neighbor 10.0.3.3 {
                description facing_dc3-rack-001-leaf1;
                local-address 10.0.3.2;
                family inet {
                    unicast;
                }
                export ( BGP-AOS-Policy );
                peer-as 64800;
            }
            vpn-apply-export;
        }
        group l3clos-l-evpn {
            type external;
            multihop {
                ttl 1;
                no-nexthop-change;
            }
            family evpn {
                signaling {
                    loops 2;
                }
            }
            multipath {
                multiple-as;
            }
            bfd-liveness-detection {
                minimum-interval 3000;
                multiplier 3;
            }
            neighbor 192.168.253.0 {
                description facing_dc3-rack-001-leaf1-evpn-overlay;
                local-address 192.168.253.1;
                family evpn {
                    signaling;
                }
                export [ ( EVPN_EXPORT ) ( LEAF_TO_LEAF_EVPN_OUT && EVPN_EXPORT ) ];
                peer-as 64800;
            }
            vpn-apply-export;
        }
        group l3rtr {
            type external;
            multihop {
                ttl 1;
            }
            family inet {
                unicast {
                    loops 2;
                }
            }
            family inet6 {
                unicast {
                    loops 2;
                }
            }
            multipath {
                multiple-as;
            }
            neighbor 172.28.0.1 {
                description facing_dc3-dc1-link2;
                multihop {
                    ttl 2;
                }
                local-address 172.28.0.2;
                import ( RoutesFromExt-default-DC3-DCI_2 );
                family inet {
                    unicast;
                }
                export ( RoutesToExt-default-DC3-DCI_2 );
                peer-as 64515;
                bfd-liveness-detection {
                    minimum-interval 1000;
                    multiplier 3;
                }
            }
            vpn-apply-export;
        }
        group evpn-gw {
            type external;
            multihop {
                ttl 30;
                no-nexthop-change;
            }
            multipath {
                multiple-as;
            }
            neighbor 192.168.255.2 {
                description facing_dc3-dc1-1-evpn-gateway;
                multihop {
                    ttl 5;
                }
                local-address 192.168.253.1;
                import ( EVPN_GW_IN );
                family evpn {
                    signaling;
                }
                export ( EVPN_GW_OUT && EVPN_EXPORT );
                peer-as 64514;
            }
            neighbor 192.168.255.3 {
                description facing_dc3-dc1-2-evpn-gateway;
                multihop {
                    ttl 5;
                }
                local-address 192.168.253.1;
                import ( EVPN_GW_IN );
                family evpn {
                    signaling;
                }
                export ( EVPN_GW_OUT && EVPN_EXPORT );
                peer-as 64515;
            }
            vpn-apply-export;
        }
        log-updown;
        graceful-restart {
            dont-help-shared-fate-bfd-down;
        }
        multipath;
    }
    evpn {
        no-core-isolation;
        interconnect-multihoming-peer-gateways [ 192.168.253.0 192.168.253.1 ];
    }
    l2-learning {
        telemetry {
            enable-remote-entries;
        }
    }
    lldp {
        port-id-subtype interface-name;
        port-description-type interface-description;
        neighbour-port-info-display port-id;
        interface all;
    }
    rstp {
        bridge-priority 0;
        interface xe-0/0/5 {
            edge;
        }
        interface ae1 {
            edge;
        }
        bpdu-block-on-edge;
    }
}
